
class Libro < ActiveRecord::Base
  belongs_to :editorial
  belongs_to :area_conocimiento
  belongs_to :dependencia
  has_many :ejemplar 
  
 
  
  

  validates :cota, :titulo, :autor,:edicion, :ano, :presence => true  
  validates :cota, :isbn,  :uniqueness => true

  has_attached_file :imagen, :styles => { :medium => "300x300>", :thumb => "60x60>" }

  after_save :load_into_soulmate

  def load_into_soulmate
    loader = Soulmate::Loader.new("libro")
    loader.add("term" => titulo, "id" => id)
  end

  def self.search(term)
    matches = Soulmate::Matcher.new('libro').matches_for_term(term)
    matches.collect {|match| {"id" => match["id"], "label" => match["term"], "value" => match["term"] } }
  end

  def titulo_and_autor
  	[titulo,autor].join(' | ')
  end


  public
  def cantidad_disponible
    ejemplar.where("estatus_ejemplar = 'Disponible' ").count      
		  		
  end

 def precio_minimo 	
	ejemplar.where("estatus_ejemplar = 'Disponible' or estatus_ejemplar = 'Solicitado'").order('costo_alquiler asc').first.costo_alquiler 

 end 	
 	
 def precio_maximo
	ejemplar.where("estatus_ejemplar = 'Disponible' or estatus_ejemplar = 'Solicitado'").order('costo_alquiler asc').last.costo_alquiler 
 end


end
